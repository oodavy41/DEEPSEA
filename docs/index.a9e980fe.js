var ve=Object.defineProperty;var Ae=(a,e,t)=>e in a?ve(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var o=(a,e,t)=>(Ae(a,typeof e!="symbol"?e+"":e,t),t);import{j as Me,c as V,a as de,b as G,f as p,d as Pe,r as De,e as Ge,g as Ce,h as Ie,m as ke,n as Be,l as Se,p as Ne,o as Oe,i as Xe,s as W,k as X,q as H,t as ue,u as $e,v as Ve,w as pe,x as _e,y as Z,z as te,A,B as re,R as xe,C as K,S as Ee,D as ae,L as ge,M as Te,E as ze,F as Ye}from"./vendor.34df925a.js";const je=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}};je();const R=Me.exports.jsx,O=Me.exports.jsxs;function We(){return O("div",{children:[R("h2",{children:"RLYEH "}),R("h3",{children:"Render Engine"}),R("h4",{children:"Click Top Menu to Show Sample"})]})}const j="position",se="coord",J="normal",be="color";class oe{constructor(e=null){o(this,"parent");o(this,"_m",V());o(this,"_nm",de());o(this,"modifyFLAG");o(this,"_position",G());o(this,"rotate");o(this,"_scale",G());o(this,"earlyDarwFuncs");o(this,"lateDarwFuncs");this.parent=e,this.m=V(),this.nm=de(),this.position=p(0,0,0),this.rotate={x:0,y:0,z:0},this.scale=p(1,1,1),this.modifyFLAG=!0,this.earlyDarwFuncs=[],this.lateDarwFuncs=[]}set m(e){this._m=e}get m(){return this.modifyFLAG&&this.make_transform(),this._m}set nm(e){this._nm=e}get nm(){return this.modifyFLAG&&this.make_transform(),this._nm}set position(e){this._position=e,this.modifyFLAG=!0}get position(){return this._position}set scale(e){this._scale=e,this.modifyFLAG=!0}get scale(){return this._scale}addEarlyDrawFunc(e){this.earlyDarwFuncs.push(e)}cleanEarlyDrawFunc(){this.earlyDarwFuncs=[]}addLateDrawFunc(e){this.lateDarwFuncs.push(e)}cleanLateDrawFunc(){this.lateDarwFuncs=[]}make_transform(){this.modifyFLAG=!1;const e=Pe();De(e,e,this.rotate.x),Ge(e,e,this.rotate.y),Ce(e,e,this.rotate.z),Ie(this.m,e,this.position,this.scale),this.parent&&ke(this.m,this.parent.m,this.m),Be(this.nm,this.m)}set_rx(e){this.rotate.x=e,this.modifyFLAG=!0}set_ry(e){this.rotate.y=e,this.modifyFLAG=!0}set_rz(e){this.rotate.z=e,this.modifyFLAG=!0}}function Je(a){const e=a.getContext("webgl");if(!e){alert(`no support for Webgl in this browser
WEBGL\u65E0\u6CD5\u5728\u6B64\u6D4F\u89C8\u5668\u521D\u59CB\u5316`);return}return e.getExtension("WEBGL_depth_texture")||alert(`no support for Webgl shadow 
WEBGL\u65E0\u6CD5\u5728\u6B64\u6D4F\u89C8\u5668\u4F7F\u7528\u9634\u5F71`),e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.depthFunc(e.LEQUAL),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e}function He(a){a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)}function we(a,e,t,s){let i;if(i=e.createShader(t),i){if(e.shaderSource(i,a),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))return i;console.error(t.toString()+":"+e.getShaderInfoLog(i))}}function Ze(a,e,t){const s=t.createProgram();if(s){if(t.attachShader(s,a),t.attachShader(s,e),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS))return s;console.error("pro:"+t.getProgramInfoLog(s))}}function Ke(a,e){const t=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array(a),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t}function qe(a,e){const t=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Int16Array(a),e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),t}function Le(a,e){const t=V(),s=V(),i=V();return Se(t,a[0],a[1],a[2]),e.length===4?Ne(s,e[0],e[1],e[2],e[3]):Oe(s,e[0],e[1],e[2],e[3],e[4],e[5]),Xe(i,s,t),i}function Qe(a,e,t,s){const i=s.getAttribLocation(t,e);if(i===-1)return console.log("no attribute called:"+e),null;const r=Ke(a,s);return s.enableVertexAttribArray(i),{att:i,vbo:r}}class z{constructor(e,t,s,i){o(this,"vs");o(this,"fs");o(this,"uniforms");o(this,"prog");o(this,"scene",null);o(this,"transform",null);this.vs=we(""+i.get(e),s,s.VERTEX_SHADER),this.fs=we(""+i.get(t),s,s.FRAGMENT_SHADER),this.vs&&this.fs&&(this.prog=Ze(this.vs,this.fs,s)),this.uniforms={}}init(e,t){this.scene=e,this.transform=t}draw(){var e;this.prog&&((e=this.scene)==null||e.GL.useProgram(this.prog))}setUniformM4f(e,t,s){if(!this.uniforms[e]&&this.prog){let i=s.getUniformLocation(this.prog,e);if(!i)return;this.uniforms[e]=i}s.uniformMatrix4fv(this.uniforms[e],!1,t),this.uniforms[e].value=t}setUniformM3f(e,t,s){if(!this.uniforms[e]&&this.prog){let i=s.getUniformLocation(this.prog,e);if(!i)return;this.uniforms[e]=i}s.uniformMatrix3fv(this.uniforms[e],!1,t),this.uniforms[e].value=t}setUniformV3f(e,t,s){if(!this.uniforms[e]&&this.prog){let i=s.getUniformLocation(this.prog,e);if(!i)return;this.uniforms[e]=i}s.uniform3fv(this.uniforms[e],t),this.uniforms[e].value=t}setUniformV4f(e,t,s){if(!this.uniforms[e]&&this.prog){let i=s.getUniformLocation(this.prog,e);if(!i)return;this.uniforms[e]=i}s.uniform4fv(this.uniforms[e],t),this.uniforms[e].value=t}setUniformI1i(e,t,s,i){if(!this.uniforms[e]&&this.prog){let r=s.getUniformLocation(this.prog,e);if(!r)return;this.uniforms[e]=r}t.bind(s,i),s.uniform1i(this.uniforms[e],i),this.uniforms[e].value=t}setUniform_1f(e,t,s){if(!this.uniforms[e]&&this.prog){let i=s.getUniformLocation(this.prog,e);if(!i)return;this.uniforms[e]=i}s.uniform1f(this.uniforms[e],t),this.uniforms[e].value=t}setUniform_1b(e,t,s){if(!this.uniforms[e]&&this.prog){let i=s.getUniformLocation(this.prog,e);if(!i)return;this.uniforms[e]=i}s.uniform1i(this.uniforms[e],t?1:0),this.uniforms[e].value=t}}class et extends z{constructor(e,t){let s=t.resRoot+t.shadersPath;super(s+"shadow_only.vert",s+"shadow_only.frag",e,t)}initS(e){this.scene=e}drawS(e,t){super.draw(),this.setUniformM4f("mvpMatrix",e,this.scene.GL),this.setUniformM4f("modelMatrix",t,this.scene.GL)}}class tt{constructor(e,t,s){o(this,"img");o(this,"texture");this.img=s.get(e),this.texture=t.createTexture(),t.activeTexture(t.TEXTURE0),console.log("tex",":"+e),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.img),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}bind(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)}}class st{constructor(e,t,s){o(this,"img",[]);o(this,"texture");e.forEach((r,h)=>{this.img[h]=s.get(r)}),this.texture=t.createTexture(),t.activeTexture(t.TEXTURE0),console.log("tex",":"+e[0]),t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture);const i=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z];t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);for(let r=0;r<6;r++)t.texImage2D(i[r],0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.img[r]),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.generateMipmap(t.TEXTURE_CUBE_MAP),t.bindTexture(t.TEXTURE_CUBE_MAP,null)}bind(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture)}}class it{constructor(e,t,s){o(this,"frameBuffer");o(this,"renderBuffer");o(this,"texture");o(this,"textData");o(this,"width");o(this,"height");this.texture=e.createTexture(),this.frameBuffer=e.createFramebuffer(),this.renderBuffer=e.createRenderbuffer(),this.textData=new Uint8Array(t*s*4),this.width=t,this.height=s,e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,s,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,s),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&console.error("FrameTexture","FrameBuffer Preparing Failed")}bind(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)}}var Y=(a=>(a[a.POINT=0]="POINT",a[a.SPOT=1]="SPOT",a[a.DIRECTION=2]="DIRECTION",a))(Y||{});class ne extends oe{constructor(e,t,s,i,r){super();o(this,"type");o(this,"_position");o(this,"_lightAim");o(this,"_lightDirection");o(this,"depthMat");o(this,"lightColor");o(this,"spotAngel");o(this,"_lightMVP");o(this,"depthFrame");e===1&&r===void 0&&console.error("define an spot light without angel!"),this.type=e,this._lightDirection=G(),this.position=t,this.lightAim=s,this.lightColor=i,this.depthFrame=void 0}set position(e){this._position=e,this.modifyFLAG=!0}get position(){return this._position}set lightAim(e){this.modifyFLAG=!0,this._lightAim=e}get lightAim(){return this._lightAim}get lightDirection(){return this.modifyFLAG&&this.makemvp(),this._lightDirection}set lightMVP(e){this._lightMVP=e}get lightMVP(){return this.modifyFLAG&&this.makemvp(),this._lightMVP}makemvp(){let e;switch(this.type){case 2:e=[-20,20,-20,20,1,100];break;case 0:e=[40,Math.PI/2,1,100];break}W(this._lightDirection,this.lightAim,this.position),this.position&&this.lightAim&&(this.lightMVP=Le([this.position,this.lightAim,p(0,1,0)],e)),super.make_transform()}enableShadow(e,t,s){this.depthMat=new et(e.GL,e.resManager),this.depthFrame=new it(e.GL,t,s,!0),this.makemvp()}disableShadow(){this.depthMat=void 0,this.depthFrame=void 0}}class ye extends z{constructor(e,t,s){let i=t.resRoot+t.shadersPath;super(i+"base_phone.vert",i+"base_phone.frag",e,t);o(this,"tex");o(this,"metalless");o(this,"smoothness");this.metalless=0,this.smoothness=0,s&&this.setTex(s)}draw(){super.draw();let e;if(this.scene.lights.Main.type===Y.DIRECTION){let t=this.scene.lights.Main.lightDirection;e=X(t[0],t[1],t[2],0)}else{let t=this.scene.lights.Main.position;e=X(t[0],t[1],t[2],1)}this.setUniformV4f("lightVector",e,this.scene.GL),this.setUniformV4f("lightColor",this.scene.lights.Main.lightColor,this.scene.GL),this.setUniformV3f("cameraPos",this.scene.mainCamera.position,this.scene.GL),this.setUniformM4f("mvpMatrix",this.scene.mainCamera.mvp,this.scene.GL),this.setUniformM4f("modelMatrix",this.transform.m,this.scene.GL),this.setUniformM3f("normalMatrix",this.transform.nm,this.scene.GL),this.setUniform_1f("metalless",this.metalless,this.scene.GL),this.setUniform_1f("smoothness",this.smoothness,this.scene.GL),this.setUniformI1i("tex",this.tex,this.scene.GL,0)}setTex(e){this.tex=e}rmTex(){this.tex=void 0}}class Re extends z{constructor(e,t){let s=t.resRoot+t.shadersPath;super(s+"base_phone_shadow.vert",s+"base_phone_shadow.frag",e,t);o(this,"tex");o(this,"metalless");o(this,"smoothness");this.metalless=0,this.smoothness=0}draw(){super.draw();let e;if(this.scene.lights.Main.type===Y.DIRECTION){let t=this.scene.lights.Main.lightDirection;e=X(t[0],t[1],t[2],0)}else{let t=this.scene.lights.Main.position;e=X(t[0],t[1],t[2],1)}this.setUniformV4f("lightVector",e,this.scene.GL),this.setUniformV4f("lightColor",this.scene.lights.Main.lightColor,this.scene.GL),this.setUniformV3f("cameraPos",this.scene.mainCamera.position,this.scene.GL),this.setUniformM4f("mvpMatrix",this.scene.mainCamera.mvp,this.scene.GL),this.setUniformM4f("modelMatrix",this.transform.m,this.scene.GL),this.setUniformM3f("normalMatrix",this.transform.nm,this.scene.GL),this.setUniform_1f("smoothness",this.smoothness,this.scene.GL),this.setUniformI1i("shadowMap",this.scene.lights.Main.depthFrame,this.scene.GL,0),this.setUniformM4f("lightMVP",this.scene.lights.Main.lightMVP,this.scene.GL),this.setUniform_1b("shadow",this.scene.shadow,this.scene.GL)}}class rt extends z{constructor(e,t,s){let i=t.resRoot+t.shadersPath;super(i+"skybox.vert",i+"skybox.frag",e,t);o(this,"tex");s&&this.setTex(s)}draw(){super.draw(),this.setUniformV3f("lightDirection",this.scene.lights.Main.lightDirection,this.scene.GL),this.setUniformV4f("lightColor",this.scene.lights.Main.lightColor,this.scene.GL),this.setUniformV3f("cameraPos",this.scene.mainCamera.position,this.scene.GL),this.setUniformM4f("mvpMatrix",this.scene.mainCamera.mvp,this.scene.GL),this.setUniformM4f("modelMatrix",this.transform.m,this.scene.GL),this.setUniformM3f("normalMatrix",this.transform.nm,this.scene.GL),this.tex||console.error("NO TEXTURE BINDED!"),this.setUniform_1b("usetex",!0,this.scene.GL),this.setUniformI1i("tex",this.tex,this.scene.GL,0)}setTex(e){this.tex=e}}class q{constructor(){o(this,"arrs");o(this,"material",null);o(this,"arr_bkup",{});o(this,"index_buffer",null);o(this,"index_length");this.arrs=Array(),this.index_length=0}set_mesh(e){this.arrs=e}set_mat(e){this.material=e}init(e){var s;const t=(s=this.material)==null?void 0:s.prog;t||console.log("no Program Binded!");for(let i=0,r=this.arrs.length;i<r;i++){const h=this.arrs[i];i<r-1?this.arr_bkup[h[0]]=Qe(h[1],h[0],t,e):(this.index_buffer=qe(h,e),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.index_buffer),this.index_length=h.length)}}draw(e){for(let t=0,s=this.arrs.length-1;t<s;t++){const i=this.arrs[t];this.arr_bkup[i[0]]&&(e.bindBuffer(e.ARRAY_BUFFER,this.arr_bkup[i[0]].vbo),e.vertexAttribPointer(this.arr_bkup[i[0]].att,i[2],e.FLOAT,!1,0,0))}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.index_buffer),e.drawElements(e.TRIANGLES,this.index_length,e.UNSIGNED_SHORT,0)}}class Q extends oe{constructor(){super();o(this,"Mesh");this.Mesh=[]}add_mesh(e){this.Mesh.push(e)}init(e){e.lights.Main;let t=this;this.Mesh.forEach(s=>{s.material.init(e,t),s.init(e.GL)})}draw(e,t=!1){let s=e.lights.Main,i=this;this.earlyDarwFuncs.forEach(r=>{r(this,e.GL)}),this.Mesh.forEach(r=>{t?(s.depthMat.drawS(s.lightMVP,i.m),r.draw(e.GL)):r.material.draw(),r.draw(e.GL)}),this.lateDarwFuncs.forEach(r=>{r(this,e.GL)})}}class ee{constructor(e){o(this,"Tranforms");this.Tranforms=e||{}}newT(e){this.Tranforms[e]=new Q}addmesh(e,t){this.Tranforms[e].add_mesh(t)}setParent(e){let t=Object.keys(e.Tranforms)[0];for(let s in this.Tranforms)this.Tranforms[s]&&(this.Tranforms[s].parent=e.Tranforms[t])}init(e){for(let t in this.Tranforms)this.Tranforms[t]&&this.Tranforms[t].init(e)}draw(e,t=!1){for(let s in this.Tranforms)this.Tranforms[s]&&this.Tranforms[s].draw(e,t)}setInfo(e,t){for(let s in this.Tranforms)this.Tranforms[s]&&t(this.Tranforms[s],e.GL)}setEarlyDraw(e){for(let t in this.Tranforms)this.Tranforms[t]&&this.Tranforms[t].addEarlyDrawFunc(e)}cleanEarlyDraw(){for(let e in this.Tranforms)this.Tranforms[e]&&this.Tranforms[e].cleanEarlyDrawFunc()}setLateDraw(e){for(let t in this.Tranforms)this.Tranforms[t]&&this.Tranforms[t].addLateDrawFunc(e)}cleanLateDraw(){for(let e in this.Tranforms)this.Tranforms[e]&&this.Tranforms[e].cleanLateDrawFunc()}}function N(a,e,t,s,i,r,h){const m=new Array,w=new Array,n=new Array,_=new Array;for(let T=0;T<=a;T++){const L=Math.PI*2/a*T,f=Math.cos(L),D=Math.sin(L);for(let P=0;P<=e;P++){const b=Math.PI*2/e*P,E=(f*t+s)*Math.cos(b),g=D*t,y=(f*t+s)*Math.sin(b),F=f*Math.cos(b),c=f*Math.sin(b);m.push(E,g,y),w.push(F,D,c);const d=at(360/e*P,1,1,1);n.push(d[0],d[1],d[2],d[3])}}for(let T=0;T<a;T++)for(let L=0;L<e;L++){const f=(e+1)*T+L;_.push(f,f+e+1,f+1),_.push(f+e+1,f+e+2,f+1)}const l=new Q,M=new q;M.set_mesh([[j,m,3],[be,n,4],[J,w,3],_]);const U=h?new Re(i,r):new ye(i,r);return M.set_mat(U),l.add_mesh(M),new ee({donghnut:l})}function at(a,e,t,s){if(e>1||t>1||s>1)return[];const i=a%360,r=Math.floor(i/60),h=i/60-r,m=t*(1-e),w=t*(1-e*h),n=t*(1-e*(1-h)),_=new Array;if(e===0)_.push(t,t,t,s);else{const l=new Array(t,w,m,m,n,t),M=new Array(n,t,t,w,m,m),U=new Array(m,m,n,t,t,w);_.push(l[r],M[r],U[r],s)}return _}function ot(a){const e=(a||1)/2,t=Array(),s=Array(),i=Array(),r=Array();function h(m,w){const n=t.length/3;let _;for(_=0;_<12;_++)t.push(m[_]);for(_=0;_<4;_++)s.push(w[0],w[1],w[2]);i.push(0,0,1,0,1,1,0,1),r.push(n,n+1,n+2,n,n+2,n+3)}return h([-e,-e,e,e,-e,e,e,e,e,-e,e,e],[0,0,1]),h([-e,-e,-e,-e,e,-e,e,e,-e,e,-e,-e],[0,0,-1]),h([-e,e,-e,-e,e,e,e,e,e,e,e,-e],[0,1,0]),h([-e,-e,-e,e,-e,-e,e,-e,e,-e,-e,e],[0,-1,0]),h([e,-e,-e,e,e,-e,e,e,e,e,-e,e],[1,0,0]),h([-e,-e,-e,-e,-e,e,-e,e,e,-e,e,-e],[-1,0,0]),[t,i,s,r]}function Fe(a,e,t){const s=ot(50),i=new Q,r=new q;r.set_mesh([[j,s[0],3],s[3]]);const h=new st(a,e,t),m=new rt(e,t,h);return r.set_mat(m),i.add_mesh(r),new ee({skybox:i})}function nt(a,e,t,s){const i=[[-a,0,-a,-a,0,a,a,0,a,a,0,-a],[.5,.5,.5,1,.5,.5,.5,1,.5,.5,.5,1,.5,.5,.5,1],[0,1,0,0,1,0,0,1,0,0,1,0],[0,1,2,0,2,3]],r=new Q,h=new q;h.set_mesh([[j,i[0],3],[be,i[1],4],[J,i[2],3],i[3]]);const m=t?new Re(e,s):new ye(e,s);return h.set_mat(m),r.add_mesh(h),new ee({panel:r})}class Ue{constructor(e){o(this,"scene");o(this,"mouseCtrlFlag");o(this,"mousePos");o(this,"movement");this.scene=e,this.mouseCtrlFlag=!1,this.mousePos=[0,0],this.movement=[!1,!1,!1,!1]}canv_on_click(){this.mouseCtrlFlag=!this.mouseCtrlFlag,this.mousePos[0]=0,this.mousePos[1]=0,console.log("canvas click",this.mouseCtrlFlag)}on_mouse_move(e){if(this.mouseCtrlFlag){if(this.mousePos[0]){let t=e.clientX-this.mousePos[0],s=e.clientY-this.mousePos[1];this.scene.mainCamera.fps_ctrl(t,s,this.movement)}this.mousePos[0]=e.clientX,this.mousePos[1]=e.clientY}}on_key_down(e){switch(e.keyCode){case 87:case 87+32:this.movement[0]=!0;break;case 65:case 65+32:this.movement[1]=!0;break;case 83:case 83+32:this.movement[2]=!0;break;case 68:case 68+32:this.movement[3]=!0;break}}on_key_up(e){switch(e.keyCode){case 87:this.movement[0]=!1;break;case 65:this.movement[1]=!1;break;case 83:this.movement[2]=!1;break;case 68:this.movement[3]=!1;break}}moveCtrl(){this.scene.mainCamera.movectrl(this.movement)}}class ht extends z{constructor(e,t,s){let i=t.resRoot+t.shadersPath;super(i+"reflect_mat.vert",i+"reflect_mat.frag",e,t);o(this,"tex");s&&this.setTex(s)}draw(){super.draw(),this.setUniformV3f("cameraPos",this.scene.mainCamera.position,this.scene.GL),this.setUniformM4f("mvpMatrix",this.scene.mainCamera.mvp,this.scene.GL),this.setUniformM4f("modelMatrix",this.transform.m,this.scene.GL),this.setUniformM3f("normalMatrix",this.transform.nm,this.scene.GL),this.tex||console.error("NO TEXTURE BINDED!"),this.setUniformI1i("tex",this.tex,this.scene.GL,0)}setTex(e){this.tex=e}}class mt extends z{constructor(e,t,s){let i=t.resRoot+t.shadersPath;super(i+"refract_mat.vert",i+"refract_mat.frag",e,t);o(this,"tex");o(this,"ratio");s&&this.setTex(s),this.ratio=1/2.4}draw(){super.draw(),this.setUniformV3f("cameraPos",this.scene.mainCamera.position,this.scene.GL),this.setUniformM4f("mvpMatrix",this.scene.mainCamera.mvp,this.scene.GL),this.setUniformM4f("modelMatrix",this.transform.m,this.scene.GL),this.setUniformM3f("normalMatrix",this.transform.nm,this.scene.GL),this.setUniform_1f("ratio",this.ratio,this.scene.GL),this.tex||console.error("NO TEXTURE BINDED!"),this.setUniformI1i("tex",this.tex,this.scene.GL,0)}setTex(e){this.tex=e}}class lt extends z{constructor(e,t,s){let i=t.resRoot+t.shadersPath;super(i+"text_phone.vert",i+"text_phone.frag",e,t);o(this,"tex");o(this,"ambient");o(this,"diffuse");o(this,"specular");o(this,"powup");this.ambient=p(1,0,0),this.diffuse=p(1,0,0),this.specular=p(1,0,0),this.powup=16,s&&this.setTex(s)}draw(){var t,s;super.draw();let e;if(((t=this.scene)==null?void 0:t.lights.Main.type)===Y.DIRECTION){let i=this.scene.lights.Main.lightDirection;e=X(i[0],i[1],i[2],0)}else{let i=(s=this.scene)==null?void 0:s.lights.Main.position;e=X(i[0],i[1],i[2],1)}this.setUniformV4f("lightVector",e,this.scene.GL),this.setUniformV4f("lightColor",this.scene.lights.Main.lightColor,this.scene.GL),this.setUniformV3f("cameraPos",this.scene.mainCamera.position,this.scene.GL),this.setUniformM4f("mvpMatrix",this.scene.mainCamera.mvp,this.scene.GL),this.setUniformM4f("modelMatrix",this.transform.m,this.scene.GL),this.setUniformM3f("normalMatrix",this.transform.nm,this.scene.GL),this.setUniformV3f("ambient",this.ambient,this.scene.GL),this.setUniformV3f("diffuse",this.diffuse,this.scene.GL),this.setUniformV3f("specular",this.specular,this.scene.GL),this.setUniform_1f("powup",this.powup,this.scene.GL),this.tex?(this.setUniformI1i("tex",this.tex,this.scene.GL,0),this.setUniform_1b("usetex",!0,this.scene.GL)):this.setUniform_1b("usetex",!1,this.scene.GL)}setTex(e){this.tex=e}rmTex(){this.tex=void 0}}function ie(a,e,t,s,i,r){let h=""+r.get(a+e);const m={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /};let w=new ee,n,_,l=[],M=[],U=[],T={};h.indexOf(`\r
`)!==-1&&(h=h.replace(/\r\n/g,`
`)),h.indexOf(`\\
`)!==-1&&(h=h.replace(/\\\n/g,""));const L=h.split(`
`);let f="",D="",P="",b=0,E=[];function g(F,c,d,u){c=(parseInt(c,10)-1)*3,d=(parseInt(d,10)-1)*2,u=(parseInt(u,10)-1)*3;let v;switch(F){case 0:v=c+"/"+d+"/"+u,T[v]?n.indexs.push(T[v]):(n.vertices.push(l[c],l[c+1],l[c+2]),n.uvs.push(U[d],U[d+1]),n.normals.push(M[u],M[u+1],M[u+2]),n.indexs.push(n.size),n.size++);break;case 1:v=c+"/"+d,T[v]?n.indexs.push(T[v]):(n.vertices.push(l[c],l[c+1],l[c+2]),n.uvs.push(U[d],U[d+1]),n.indexs.push(n.size),n.size++);break;case 2:v=c+"//"+u,T[v]?n.indexs.push(T[v]):(n.vertices.push(l[c],l[c+1],l[c+2]),n.normals.push(M[u],M[u+1],M[u+2]),n.indexs.push(n.size),n.size++);break;case 3:v=c,T[v]?n.indexs.push(T[v]):(n.vertices.push(l[c],l[c+1],l[c+2]),n.indexs.push(n.size),n.size++);break}}for(let F=0,c=L.length;F<c;F++)if(f=L[F],f=f.trim(),b=f.length,b!==0&&(D=f.charAt(0),D!=="#")){if(D==="v")if(P=f.charAt(1),P===" "&&(E=m.vertex_pattern.exec(f))!==null)l.push(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3]));else if(P==="n"&&(E=m.normal_pattern.exec(f))!==null)M.push(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3]));else if(P==="t"&&(E=m.uv_pattern.exec(f))!==null)U.push(parseFloat(E[1]),parseFloat(E[2]));else throw new Error("Unexpected vertex/normal/uv line: '"+f+"'");else if(D==="f")if((E=m.face_vertex_uv_normal.exec(f))!==null){let d;E[10]===void 0?d=[1,4,7]:d=[1,4,7,1,7,10],d.forEach(u=>{g(0,E[u],E[u+1],E[u+2])})}else if((E=m.face_vertex_uv.exec(f))!==null){let d;E[7]===void 0?d=[1,3,5]:d=[1,3,5,1,5,7],d.forEach(function(u){g(1,E[u],E[u+1],void 0)})}else if((E=m.face_vertex_normal.exec(f))!==null){let d;E[7]===void 0?d=[1,3,5]:d=[1,3,5,1,5,7],d.forEach(function(u){g(2,E[u],void 0,E[u+1])})}else if((E=m.face_vertex.exec(f))!==null){let d;E[4]===void 0?d=[1,2,3]:d=[1,2,3,1,3,4],d.forEach(function(u){g(3,E[u],void 0,void 0)})}else throw new Error("Unexpected face line: '"+f+"'");else if(D!=="l"){if((E=m.object_pattern.exec(f))!==null){if(E[0].substr(1).trim()==="default")continue;if(n&&_){let d=n.mesh;d.set_mesh([[j,n.vertices,3],[se,n.uvs,2],[J,n.normals,3],n.indexs]),w.addmesh(_,d)}n={mesh:null,vertices:[],normals:[],uvs:[],indexs:[],size:0},T={},_=E[0].substr(1).trim(),w.newT(_)}else if(m.material_use_pattern.test(f)){const d=f.substring(7).trim()+i;if(n&&n.mesh){let u=n.mesh;u.set_mesh([[j,n.vertices,3],[se,n.uvs,2],[J,n.normals,3],n.indexs]),w.addmesh(_,u)}n={mesh:null,vertices:[],normals:[],uvs:[],indexs:[],size:0},T={},n.mesh=new q,t[d]||console.log("no such mtl:"+d),n.mesh.set_mat(t[d])}else if(m.material_library_pattern.test(f))ct(a,f.substring(7).trim(),t,s,i,r);else if((E=m.smoothing_pattern.exec(f))===null){if(f==="\0")continue;throw new Error("Unexpected line: '"+f+"'")}}}let y=n.mesh;return y.set_mesh([[j,n.vertices,3],[se,n.uvs,2],[J,n.normals,3],n.indexs]),w.addmesh(_,y),w}function ct(a,e,t,s,i,r){let h,m={text_phone:()=>new lt(s,r),reflect_mat:()=>new ht(s,r),refract_mat:()=>new mt(s,r)},n=(""+r.get(a+e)).split(`
`),_=/\s+/;for(let l=0;l<n.length;l++){let M=n[l];if(M=M.trim(),M.length===0||M.charAt(0)==="#")continue;let U=M.indexOf(" "),T=U>=0?M.substring(0,U):M;T=T.toLowerCase();let L=U>=0?M.substring(U+1):"";if(L=L.trim(),T==="newmtl")L+=i,t[L]&&console.log("same mtl name",L),h=t[L]=m[i](),console.log("mtlload",L);else if(h){if(T==="ka"||T==="kd"||T==="ks"){const f=L.split(_,3);switch(T){case"ka":h.ambient=p(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2]));break;case"kd":h.diffuse=p(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2]));break;case"ks":h.specular=p(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2]));break}}else if(T==="ns")h.powup=parseFloat(L);else if(T==="map_kd"){const f=new tt(a+L,s,r);h.setTex(f)}}}}class he{constructor(e,t,s,i){o(this,"resRoot");o(this,"modelsPath");o(this,"shadersPath");o(this,"skyboxPath");o(this,"pool");this.pool={},this.resRoot=e,this.modelsPath=t,this.shadersPath=s,this.skyboxPath=i}add(e,t){this.pool[e]=t}get(e){if(!this.pool[e])console.error("resManagr","individual path\uFF1A"+e);else return this.pool[e]}}const ft={FPSZeroElevation:5,FPSraid:50,MoveSpeed:.1},I=ft;class dt extends oe{constructor(){super();o(this,"_cameraModified",!0);o(this,"_cameraUp",G());o(this,"_cameraAim",G());o(this,"cameraRight");o(this,"elevation",0);o(this,"cameraInfo");o(this,"_mvp");this.cameraRight=p(1,0,0),this.cameraAim=p(0,0,-1),this.cameraUp=p(0,1,0),this.cameraInfo=[Math.PI/3,9/16,.01,1e4],this._mvp=null}set cameraUp(e){H(e,e),this._cameraUp=e,this._cameraModified=!0}get cameraUp(){return this._cameraUp}set cameraAim(e){this._cameraAim=e,this._cameraModified=!0}get cameraAim(){return this._cameraAim}get mvp(){return this._cameraModified&&this.reset(),this._mvp}set position(e){this._position=e,this.modifyFLAG=!0,this._cameraModified=!0}get position(){return this._position}reset(){if(this.cameraAim&&this.cameraUp&&this.cameraRight){let e=G();if(W(e,this.cameraAim,this.position),H(e,e),ue(this.cameraRight,e,this.cameraUp),this.elevation=$e(W(G(),this.cameraAim,this.position),this.cameraUp)/Math.PI*180,this.elevation<I.FPSZeroElevation){console.error("camera","camera aim to high");return}this.makemvp()}}makemvp(){this.position&&this.cameraAim&&this.cameraUp&&this.cameraInfo&&(this._mvp=Le([this.position,this.cameraAim,this.cameraUp],this.cameraInfo)),this._cameraModified=!1}fps_ctrl(e,t,s){let i=G();W(i,this.cameraAim,this.position),H(i,i),ue(this.cameraRight,i,this.cameraUp);const r=[t,-e];r[0]=Math.max(r[0],-I.FPSraid),r[1]=Math.max(r[1],-I.FPSraid),r[0]=Math.min(r[0],I.FPSraid),r[1]=Math.min(r[1],I.FPSraid);let h=Math.asin(r[0]/I.FPSraid)/Math.PI*180,m=Math.asin(r[1]/I.FPSraid)/Math.PI*180;this.elevation||this.reset();let w=V(),n=V(),_=Ve(this.cameraUp);return this.elevation+=h,this.elevation=Math.min(this.elevation,180-I.FPSZeroElevation),this.elevation=Math.max(this.elevation,I.FPSZeroElevation),pe(w,w,-this.elevation/180*Math.PI,this.cameraRight),pe(n,n,m/180*Math.PI,this.cameraUp),_e(_,_,w),_e(_,_,n),Z(this.cameraAim,this.position,_),this.makemvp(),r}movectrl(e){let t=G(),s=G(),i=G();W(i,this.cameraAim,this.position);const r=[i,te(s,this.cameraRight,-1),te(t,i,-1),this.cameraRight],h=p(0,0,0);for(let m=0;m<4;m++)e[m]&&Z(h,h,r[m]);H(h,h),te(h,h,I.MoveSpeed),Z(this.position,this.position,h),Z(this.cameraAim,this.cameraAim,h),this.makemvp()}}class me{constructor(e,t){o(this,"SELF");o(this,"requestFramer");o(this,"GL");o(this,"framectx");o(this,"update",e=>{});o(this,"mainCamera");o(this,"cameras");o(this,"lights");o(this,"skybox");o(this,"resManager");o(this,"mtllib");o(this,"Time");o(this,"deltaTime");o(this,"state");o(this,"glc");o(this,"OBJs");o(this,"initFuns");o(this,"updtFuns");o(this,"_shadow");this.SELF=this,this.requestFramer=0,this.state=0,this.initFuns=[],this.updtFuns=[],this.resManager=t,this._shadow=!1,this.cameras={},this.lights={},this.mainCamera=this.cameras.Main=new dt,this.mtllib={},this.glc=e,this.GL=Je(e),this.Time=0,this.deltaTime=0,this.OBJs=[]}get shadow(){return this._shadow}ObjNums(){return this.OBJs.length}LoadSence(e){this.OBJs=e}AddObj(e){this.OBJs.push(e)}EnableShadow(e,t){this.lights.Main.enableShadow(this,e,t),this._shadow=!0}DisableShadow(){this.lights.Main.disableShadow(),this._shadow=!1}Run(){this.OBJs.length!==0?(this._Init(),this._update()):console.warn("no any OBJS be loaded")}End(){var e,t;cancelAnimationFrame(this.requestFramer),(t=(e=this.GL)==null?void 0:e.getExtension("WEBGL_lose_context"))==null||t.loseContext()}_Init(){this.Time=Date.now();for(let t=0,s=this.OBJs.length;t<s;t++)this.OBJs[t].init(this);let e=this.lights.Main;this.shadow&&e.depthMat.initS(this),this.state++}_update(){var e,t,s,i,r,h,m,w,n,_;if(this.deltaTime=Date.now()-this.Time,this.Time=Date.now(),(e=this.update)==null||e.call(this,this),this.GL&&He(this.GL),this.shadow){let l=this.lights.Main;(s=this.GL)==null||s.bindFramebuffer((t=this.GL)==null?void 0:t.FRAMEBUFFER,l.depthFrame.frameBuffer),(i=this.GL)==null||i.viewport(0,0,l.depthFrame.width,l.depthFrame.height),(h=this.GL)==null||h.clear(((r=this.GL)==null?void 0:r.COLOR_BUFFER_BIT)|this.GL.DEPTH_BUFFER_BIT);for(let M=0,U=this.OBJs.length;M<U;M++)this.OBJs[M].draw(this,!0);(m=this.GL)==null||m.readPixels(0,0,l.depthFrame.width,l.depthFrame.height,this.GL.RGBA,this.GL.UNSIGNED_BYTE,l.depthFrame.textData),(w=this.GL)==null||w.bindFramebuffer(this.GL.FRAMEBUFFER,null),(n=this.GL)==null||n.viewport(0,0,this.glc.width,this.glc.height)}for(let l=0,M=this.OBJs.length;l<M;l++)this.OBJs[l].draw(this);(_=this.GL)==null||_.flush(),this.requestFramer=requestAnimationFrame(()=>this._update())}}function ut(){const a=A.exports.useRef(null),[e,t]=A.exports.useState(!0),[s,i]=A.exports.useState(0),[r,h]=A.exports.useState(0),m=A.exports.useRef([0,0]),w=A.exports.useRef([]);return A.exports.useEffect(()=>{if(!a.current)return;let n=a.current,_=new he("assets/resource/","models/","shaders/","skyboxs/"),l=new me(n,_),M=new Ue(l),U=l.GL;w.current=[u=>M.canv_on_click(u),u=>M.on_mouse_move(u),u=>M.on_key_down(u),u=>M.on_key_up(u)],a.current.addEventListener("click",w.current[0]),document.body.addEventListener("mousemove",w.current[1]),document.body.addEventListener("keypress",w.current[2]),document.body.addEventListener("keyup",w.current[3]);let T=p(10,0,1),L=p(0,0,0),f=X(1,1,1,1),D=p(-15,8,16),P=p(0,0,-5),b=p(0,1,0),E=[Math.PI/3,n.width/n.height,.01,100];l.lights.Main=new ne(Y.DIRECTION,T,L,f),l.mainCamera.position=D,l.mainCamera.cameraAim=P,l.mainCamera.cameraUp=b,l.mainCamera.cameraInfo=E;let g="assets/resource/",y=["skyboxs/bs2/X.png","skyboxs/bs2/-X.png","skyboxs/bs2/Y.png","skyboxs/bs2/-Y.png","skyboxs/bs2/Z.png","skyboxs/bs2/-Z.png","models/teapot/default.jpg"],F=["shaders/anim_edge_phone.frag","shaders/anim_edge_phone.vert","shaders/anim_phone.frag","shaders/anim_phone.vert","shaders/base_phone.frag","shaders/base_phone.vert","shaders/reflect_mat.frag","shaders/reflect_mat.vert","shaders/refract_mat.frag","shaders/refract_mat.vert","shaders/shadow_only.frag","shaders/shadow_only.vert","shaders/skybox.frag","shaders/skybox.vert","shaders/text_phone.frag","shaders/text_phone.vert","models/teapot/default.mtl","models/teapot/teapot.obj"],c=y.map((u,v)=>new Promise(($,k)=>{let B=setTimeout(k,1e4),C=new Image;C.onload=()=>{_.add(`${g}${u}`,C),clearTimeout(B),$()},C.src=`${g}${u}`})),d=F.map((u,v)=>new Promise(($,k)=>{let B=setTimeout(k,1e4);re.get(`${g}${u}`,{responseType:"text"}).then(C=>{_.add(`${g}${u}`,C.data),clearTimeout(B),$()})}));return Promise.all([...c,...d]).then(()=>{let u=Fe([`${g}${y[0]}`,`${g}${y[1]}`,`${g}${y[2]}`,`${g}${y[3]}`,`${g}${y[4]}`,`${g}${y[5]}`],U,_);u.setEarlyDraw((x,S)=>{x.position=l.mainCamera.position,S.cullFace(S.FRONT)}),u.setLateDraw((x,S)=>{S.cullFace(S.BACK)}),l.skybox=u.Tranforms.skybox;let v=u.Tranforms.skybox.Mesh[0].material.tex,$=N(30,36,1,3,U,_,!1);$.setInfo(l,x=>{x.Mesh[0].material.setTex(v),x.position=p(1,3,2),x.Mesh[0].material.metalless=.8,x.Mesh[0].material.smoothness=8}),$.setEarlyDraw((x,S)=>{x.set_rz(Date.now()/5e3)});let k=N(30,36,1,3,U,_,!1);k.setInfo(l,x=>{x.Mesh[0].material.setTex(v),x.position=p(4,4,2),x.scale=p(.5,.5,.5),x.Mesh[0].material.metalless=.1,x.Mesh[0].material.smoothness=4}),k.setParent($),k.setEarlyDraw((x,S)=>{x.set_rx(-Date.now()/2e3),x.set_ry(-Date.now()/2e3)});let B=N(30,36,1,3,U,_,!1);B.setInfo(l,x=>{x.Mesh[0].material.setTex(v),x.position=p(2,2,2),x.scale=p(.2,1,.2),x.Mesh[0].material.metalless=.1,x.Mesh[0].material.smoothness=.1}),B.setParent(k),B.setEarlyDraw((x,S)=>{x.set_rz(Date.now()/2e3),x.set_ry(Date.now()/2e3)});let C=N(30,36,1,3,U,_,!1);C.setInfo(l,x=>{x.Mesh[0].material.setTex(v),x.position=p(5,5,5),x.Mesh[0].material.metalless=.1,x.Mesh[0].material.smoothness=.1}),C.setParent(B),C.setEarlyDraw((x,S)=>{x.set_rx(Date.now()/2e3),x.set_rz(Date.now()/2e3)});let le=ie(`${g}models/teapot/`,"teapot.obj",l.mtllib,l.GL,"text_phone",_);le.setInfo(l,x=>{x.position=p(5,-5,0),x.scale=p(40,40,40)});let ce=ie(`${g}models/teapot/`,"teapot.obj",l.mtllib,l.GL,"reflect_mat",_);ce.setInfo(l,x=>{x.Mesh[0].material.setTex(v),x.position=p(0,-5,0),x.scale=p(40,40,40)});let fe=ie(`${g}models/teapot/`,"teapot.obj",l.mtllib,l.GL,"refract_mat",_);fe.setInfo(l,x=>{x.Mesh[0].material.setTex(v),x.position=p(0,-5,5),x.scale=p(40,40,40)}),t(!1),l.LoadSence([u,$,k,B,C,le,ce,fe]),l.update=x=>{M.moveCtrl(),l.lights.Main.position=p(m.current[0],m.current[1],2)},l.Run()}).catch(u=>{console.error(u)}),()=>{var u;(u=a.current)==null||u.removeEventListener("click",w.current[0]),document.body.removeEventListener("mousemove",w.current[1]),document.body.removeEventListener("keypress",w.current[2]),document.body.removeEventListener("keyup",w.current[3]),l.End()}},[]),A.exports.useEffect(()=>{m.current=[s,r]},[s,r]),O("div",{style:{width:1200},children:[R("h2",{children:"Click to rotate,WASD to move"}),O(xe,{children:[R(K,{span:4,children:"LightX"}),R(K,{span:8,children:R(Ee,{defaultValue:1,max:10,min:-10,onChange:i})})]}),O(xe,{children:[R(K,{span:4,children:"LightY"}),R(K,{span:8,children:R(Ee,{defaultValue:1,max:10,min:-10,onChange:h})})]}),e&&R("div",{style:{display:"table",width:"fit-content",height:800,margin:"0 auto "},children:R(ae,{style:{display:"table-cell",verticalAlign:"middle"},tip:"Loading..."})}),R("canvas",{style:{width:1200,height:800,visibility:e?"hidden":"visible"},width:1200,height:800,ref:a})]})}function pt(){const a=A.exports.useRef(null),[e,t]=A.exports.useState(!0);return A.exports.useEffect(()=>{if(!a.current)return;let s=a.current,i=new he("assets/resource/","models/","shaders/","skyboxs/"),r=new me(s,i);new Ue(r);let h=r.GL,m=p(10,0,1),w=p(0,0,0),n=X(1,1,1,1),_=p(0,20,0),l=p(0,0,0),M=p(-1,0,0),U=[Math.PI/3,s.width/s.height,.01,100];r.lights.Main=new ne(Y.DIRECTION,m,w,n),r.mainCamera.position=_,r.mainCamera.cameraAim=l,r.mainCamera.cameraUp=M,r.mainCamera.cameraInfo=U;let T="assets/resource/",L=["skyboxs/bs2/X.png","skyboxs/bs2/-X.png","skyboxs/bs2/Y.png","skyboxs/bs2/-Y.png","skyboxs/bs2/Z.png","skyboxs/bs2/-Z.png","models/teapot/default.jpg"],f=["shaders/anim_edge_phone.frag","shaders/anim_edge_phone.vert","shaders/anim_phone.frag","shaders/anim_phone.vert","shaders/base_phone.frag","shaders/base_phone.vert","shaders/reflect_mat.frag","shaders/reflect_mat.vert","shaders/refract_mat.frag","shaders/refract_mat.vert","shaders/shadow_only.frag","shaders/shadow_only.vert","shaders/skybox.frag","shaders/skybox.vert","shaders/text_phone.frag","shaders/text_phone.vert","models/teapot/default.mtl","models/teapot/teapot.obj"],D=L.map((b,E)=>new Promise((g,y)=>{let F=setTimeout(y,1e4),c=new Image;c.onload=()=>{i.add(`${T}${b}`,c),clearTimeout(F),g()},c.src=`${T}${b}`})),P=f.map((b,E)=>new Promise((g,y)=>{let F=setTimeout(y,1e4);re.get(`${T}${b}`,{responseType:"text"}).then(c=>{i.add(`${T}${b}`,c.data),clearTimeout(F),g()})}));return Promise.all([...D,...P]).then(()=>{let b=Fe([`${T}${L[0]}`,`${T}${L[1]}`,`${T}${L[2]}`,`${T}${L[3]}`,`${T}${L[4]}`,`${T}${L[5]}`],h,i);b.setEarlyDraw((y,F)=>{y.position=r.mainCamera.position,F.cullFace(F.FRONT)}),b.setLateDraw((y,F)=>{F.cullFace(F.BACK)}),r.skybox=b.Tranforms.skybox;let E=b.Tranforms.skybox.Mesh[0].material.tex,g=[];for(let y=0;y<11;y++)for(let F=0;F<11;F++){let c=N(8,32,.15,.5,h,i,!1);c.setInfo(r,d=>{d.Mesh[0].material.setTex(E),d.position=p(-10+y*2,0,-10+F*2),d.rotation=p(90,0,0),d.Mesh[0].material.metalless=y/10,d.Mesh[0].material.smoothness=Math.pow(1.5,F)}),g.push(c)}t(!1),r.LoadSence([b,...g]),r.update=y=>{},r.Run()}).catch(b=>{console.error(b)}),()=>{r.End()}},[]),O("div",{style:{width:1200},children:[e&&R("div",{style:{display:"table",width:"fit-content",height:800,margin:"0 auto "},children:R(ae,{style:{display:"table-cell",verticalAlign:"middle"},tip:"Loading..."})}),R("canvas",{style:{width:1200,height:800},width:1200,height:800,ref:a})]})}function _t(){const a=A.exports.useRef(null),e=A.exports.useRef(null),[t,s]=A.exports.useState(!0);return A.exports.useEffect(()=>{if(!(a.current&&e.current))return;let i=a.current,r=e.current.getContext("2d"),h=new he("assets/resource/","models/","shaders/","skyboxs/"),m=new me(i,h),w=m.GL;m.framectx=r;let n=p(-10,10,1),_=p(0,-10,0),l=X(1,1,1,1),M=p(10,40,10),U=p(0,-10,0),T=p(0,1,0),L=[Math.PI/3,i.width/i.height,1,1e3];m.lights.Main=new ne(Y.DIRECTION,n,_,l),m.mainCamera.position=M,m.mainCamera.cameraAim=U,m.mainCamera.cameraUp=T,m.mainCamera.cameraInfo=L;let f="assets/resource/",P=["shaders/base_phone_shadow.frag","shaders/base_phone_shadow.vert","shaders/base_phone.frag","shaders/base_phone.vert","shaders/shadow_only.frag","shaders/shadow_only.vert","shaders/text_phone.frag","shaders/text_phone.vert"].map((b,E)=>new Promise((g,y)=>{let F=setTimeout(y,1e4);re.get(`${f}${b}`,{responseType:"text"}).then(c=>{h.add(`${f}${b}`,c.data),clearTimeout(F),g()})}));return Promise.all(P).then(()=>{s(!1),m.EnableShadow(512,512);let b=N(30,36,1,3,w,h,m.shadow);b.setInfo(m,c=>{c.Mesh[0].material.smoothness=1,c.position=p(1,3,2)}),b.setEarlyDraw((c,d)=>{c.set_rz(Date.now()/5e3)});let E=N(30,36,1,3,w,h,m.shadow);E.setInfo(m,c=>{c.Mesh[0].material.smoothness=1,c.position=p(4,4,2),c.scale=p(.5,.5,.5)}),E.setParent(b),E.setEarlyDraw((c,d)=>{c.set_rx(-Date.now()/2e3),c.set_ry(-Date.now()/2e3)});let g=N(30,36,1,3,w,h,m.shadow);g.setInfo(m,c=>{c.Mesh[0].material.smoothness=1,c.position=p(2,2,2),c.scale=p(.2,1,.2)}),g.setParent(E),g.setEarlyDraw((c,d)=>{c.set_rz(Date.now()/2e3),c.set_ry(Date.now()/2e3)});let y=N(30,36,1,3,w,h,m.shadow);y.setInfo(m,c=>{c.Mesh[0].material.smoothness=1,c.position=p(5,5,5)}),y.setParent(g),y.setEarlyDraw((c,d)=>{c.set_rx(Date.now()/2e3),c.set_rz(Date.now()/2e3)});let F=nt(30,w,m.shadow,h);F.setInfo(m,c=>{c.position=p(0,-10,0),c.Mesh[0].material.smoothness=1}),m.LoadSence([b,E,g,y,F]),m.update=c=>{let d=new ImageData(new Uint8ClampedArray(m.lights.Main.depthFrame.textData.buffer),512,512);r.putImageData(d,0,0)},m.Run()}).catch(b=>{console.error(b)}),()=>{m.End()}},[]),O("div",{style:{width:1200},children:[t&&R("div",{style:{display:"table",width:"fit-content",height:800,margin:"0 auto "},children:R(ae,{style:{display:"table-cell",verticalAlign:"middle"},tip:"Loading..."})}),O("div",{style:{width:1610,margin:10},children:[R("canvas",{style:{width:1200,height:800},width:1200,height:800,ref:a}),R("canvas",{style:{float:"right",width:400,height:400},width:512,height:512,ref:e})]})]})}const{Header:xt,Content:Et,Footer:Tt}=ge;function wt(){const[a,e]=A.exports.useState("Home");return O(ge,{className:"layout",children:[O(xt,{children:[R("div",{className:"logo"}),R(Te,{theme:"dark",mode:"horizontal",defaultSelectedKeys:["2"],children:["Home","BasicScene","PBRMaterial","ShadowMap"].map((t,s)=>{const i=t+(s+1);return R(Te.Item,{onClick:()=>e(t),children:R("label",{children:t})},i)})})]}),R(Et,{style:{padding:"0 50px"},children:{Home:R(We,{},"Home"),BasicScene:R(ut,{},"BasicScene"),PBRMaterial:R(pt,{},"PBRMaterial"),ShadowMap:R(_t,{},"ShadowMap")}[a]}),R(Tt,{style:{textAlign:"center"},children:"Ant Design \xA92018 Created by Ant UED"})]})}ze.render(R(Ye.StrictMode,{children:R(wt,{})}),document.getElementById("root"));
